FROM openjdk:11-jre
LABEL maintainer="wclayf@gmail.com"

ARG JAR_FILE
ARG PORT
ARG PORT_DEBUG
ARG XMS
ARG XMX

RUN mkdir -p /dev-resource-base
RUN echo "SubNode resources" > /dev-resource-base/readme.md

RUN mkdir -p /loader-path
RUN echo "SubNode classes" > /loader-path/readme.md

WORKDIR /quanta

EXPOSE ${PORT}
EXPOSE ${PORT_DEBUG}

# This 'target' path assumes we're running docker from the source project root 
COPY ${JAR_FILE} /quanta/app.jar
RUN sh -c 'touch /quanta/app.jar' 

ENTRYPOINT ["java", "-Dloader.path=/loader-path", "-Djava.security.egd=file:/dev/./urandom", "-jar", "/quanta/app.jar"]
CMD ["-Xms${XMS}", "-Xmx${XMX}"]
