<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <base href="/" />

    <meta charset="utf-8" />
    <meta property="instanceId" th:attr="content=${instanceId}" />
    <meta name="description" th:attr="content=${brandingMetaContent}" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="theme-color" content="#000000" />

    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" th:attr="content=${brandingAppName}" />

    <meta property="og:type" th:if="${not #strings.isEmpty(ogDescription)}" content="website" />
    <meta property="og:title" th:if="${not #strings.isEmpty(ogTitle)}" th:attr="content=${ogTitle}" />
    <meta property="og:description" th:if="${not #strings.isEmpty(ogDescription)}" th:attr="content=${ogDescription}" />
    <meta property="og:image" th:if="${not #strings.isEmpty(ogImage)}" th:attr="content=${ogImage}" />
    <meta property="og:url" th:if="${not #strings.isEmpty(ogUrl)}" th:attr="content=${ogUrl}" />

    <meta name="twitter:card" th:if="${not #strings.isEmpty(ogDescription)}" content="summary" />
    <meta name="twitter:title" th:if="${not #strings.isEmpty(ogTitle)}" th:attr="content=${ogTitle}" />
    <meta name="twitter:description" th:if="${not #strings.isEmpty(ogDescription)}"
        th:attr="content=${ogDescription}" />
    <meta name="twitter:image" th:if="${not #strings.isEmpty(ogImage)}" th:attr="content=${ogImage}" />

    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=3" />
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=3" />
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=3" />
    <link rel="manifest" href="/site.webmanifest" />

    <title th:text="${brandingAppName}"></title>

    <script nomodule>
        alert("Your browser is too old. This app requires a newer browser.\n\nYour Browser: " + (navigator.userAgent || navigator.vendor || window.opera));
    </script>

    <script th:inline="javascript">
        var _debug = false;
        var __page = "index";
        var __initAppStarted = false;
        var browserFailed = false;

        function browserFail() {
            if (browserFailed) return;
            browserFailed = true;
            alert("Your browser is too old. This app requires a newer browser.\n\nYour Browser: " + (navigator.userAgent || navigator.vendor || window.opera));
        }

        if (location.href.indexOf("-app-debug") != -1) {
            _debug = true;
            var cLog = console.log;

            console.log = function (msg) {
                alert("log: " + msg);
                cLog(msg);
            };

            var cError = console.error;
            console.error = function (msg) {
                alert("error: " + msg);
                cError(msg);
            };

            console.log("Debug is on: " + location.href);
        }

        function checkES6() {
            "use strict";
            let fail = false;
            try {
                console.log("class check");
                // test class support
                eval("class Foo {}");

                // test let and const
                console.log("let check");
                eval("let bar = (x) => x+1; const c = 1;");

                // test Promises
                console.log("promise check");
                eval("let promise = new Promise((resolve, reject) => {});");

                // test object literals
                console.log("object literals check");
                eval("function f(a) {return {a}}; f('x');");

                // test template literals 
                // why is this not working? todo-0
                console.log("template literals check");
                eval("let ins='a'; let val=`${ins}`;");

                // test destructuring
                console.log("destructuring check");
                eval("let letters = ['a', 'b']; let [a, b] = letters;");
            } catch (e) {
                fail = true;
            }

            if (fail) {
                browserFail();
            }
            else {
                console.log("Browser compatability: OK.");
            }
        }
        checkES6();

        function supportsStaticImport() {
            const script = document.createElement('script');
            return 'noModule' in script;
        }

        if (!supportsStaticImport()) {
            browserFail();
        }

        window.addEventListener("load", function (event) {
            console.log("load event: " + event.target.nodeName);

            setTimeout(function () {
                // if this is still false a full 2 seconds after we KNOW the browser finished loading the
                // javascript app bundle, then we can conclude the browser engine's JS is failing and just
                // tell the user.
                if (!__initAppStarted) {
                    alert("App failed to load. Your browser may be outdated: \n\n" + (navigator.userAgent || navigator.vendor || window.opera));
                }
            }, 2000);
        }, true);

        /* Thymeleaf vars */
        var g_brandingAppName = [[${ brandingAppName }]];
        console.log("Page JS Running");
    </script>

</head>

<body class="app-body">
    <noscript>
        This app requires JavaScript.
    </noscript>

    <div id="app">
        <h4>Loading...</h4>
    </div>

    <div id="overlayDiv" class="overlay"></div>
</body>

</html>